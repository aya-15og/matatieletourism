# =================================================================
# PHASE 1: STRUCTURAL AND CANONICAL SEO FIXES
# =================================================================

# Enable Rewrite Engine
RewriteEngine On

# 1.1. Canonical Redirect: Enforce non-www as canonical
# Redirects www.matatiele.co.za to https://matatiele.co.za/
RewriteCond %{HTTP_HOST} ^www\.matatiele\.co\.za [NC]
RewriteRule ^(.*)$ https://matatiele.co.za/$1 [L,R=301]

# =================================================================
# PHASE 2: SECURITY HEADER IMPLEMENTATION (GRADE F FIX)
# =================================================================

# 2.1. X-Frame-Options: Prevents Clickjacking
Header always set X-Frame-Options "SAMEORIGIN"

# 2.2. X-Content-Type-Options: Prevents MIME-sniffing
Header always set X-Content-Type-Options "nosniff"

# 2.3. Referrer-Policy: Protects user privacy
Header always set Referrer-Policy "strict-origin-when-cross-origin"

# 2.4. Strict-Transport-Security (HSTS): Enforces HTTPS
# WARNING: Only enable after confirming all subdomains and assets are served over HTTPS
# This header forces browsers to only use HTTPS for the next year (31536000 seconds)
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains" env=HTTPS

# 2.5. Permissions-Policy: Disables unnecessary browser features
# Example: Disabling camera, microphone, and geolocation
Header always set Permissions-Policy "camera=(), microphone=(), geolocation=()"

# 2.6. Content-Security-Policy (CSP): Prevents XSS
# WARNING: This is a basic, permissive policy. It must be tested thoroughly.
# The 'unsafe-inline' and 'unsafe-eval' directives are included to prevent breaking existing scripts.
# For maximum security, these should be removed after a full audit.
Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self';"